<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BSS Hive Planner ‚Äî WebP/JPG/PNG fallback</title>
<style>
*{box-sizing:border-box}:root{--bg:#0b0d10;--card:#12161b;--muted:#8892a2;--text:#eef2f8;--border:#222a33}
html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto}
.container{max-width:1200px;margin:0 auto;padding:20px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{grid-column:span 6;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.card.full{grid-column:span 12}
.hive{display:grid;grid-template-columns:repeat(10,56px);grid-auto-rows:56px;gap:6px;background:#0a0e12;padding:8px;border-radius:12px;border:1px solid var(--border)}
.slot{width:56px;height:56px;border:1px dashed #24303c;border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;background:#0c1116}
.slot img{width:48px;height:48px;border-radius:10px;pointer-events:none}
.slot .x{position:absolute;top:2px;right:4px;background:#1a1111;border:1px solid #3b2222;color:#ffb0b0;border-radius:6px;padding:0 4px;font-size:.75rem;display:none}
.slot.filled .x{display:block;cursor:pointer}
.pal{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.pal .bee{display:flex;gap:10px;padding:8px;border:1px solid var(--border);border-radius:12px;background:#0f1318;align-items:center}
.pal .bee img{width:36px;height:36px;border-radius:8px;flex:0 0 36px}
.badge{display:inline-flex;gap:6px;align-items:center;background:#0f1318;border:1px solid var(--border);padding:8px;border-radius:10px}
.badge img{width:20px;height:20px;border-radius:5px}
@media(max-width:900px){.card{grid-column:span 12}.hive{grid-template-columns:repeat(5,56px)}} 
</style>
</head>
<body>
<header class="container">
  <h1>üêù BSS Hive Planner ‚Äî WebP/PNG/JPG –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h1>
  <p class="sub">–ò–∫–æ–Ω–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ <code>assets/bees|masks|tools/&lt;id&gt;.(webp|png|jpg|jpeg|gif)</code></p>
</header>

<main class="container grid">
  <section class="card">
    <h2>–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h2>
    <label>–ú–∞—Å–∫–∞ <select id="maskSelect"></select></label>
    <label>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç <select id="toolSelect"></select></label>
    <div id="itemsBox"></div>
    <div id="gearIcons" class="legend"></div>
  </section>

  <section class="card full">
    <h2>–£–ª–µ–π –Ω–∞ 50 —Å–ª–æ—Ç–æ–≤</h2>
    <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
      <div>
        <div class="hive" id="hive"></div>
      </div>
      <div style="flex:1;min-width:320px">
        <h3>–ü–∞–ª–∏—Ç—Ä–∞ –ø—á—ë–ª</h3>
        <div class="pal" id="beePalette"></div>
      </div>
    </div>
  </section>
</main>

<script>
const PH_BEE="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'><rect width='96' height='96' rx='16' fill='%232b3642'/><text x='50%' y='56%' text-anchor='middle' fill='white' font-size='54' font-family='system-ui' font-weight='700'>B</text></svg>";
const PH_MASK="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'><rect width='96' height='96' rx='16' fill='%233a2b42'/><text x='50%' y='56%' text-anchor='middle' fill='white' font-size='54' font-family='system-ui' font-weight='700'>M</text></svg>";
const PH_TOOL="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'><rect width='96' height='96' rx='16' fill='%232b4232'/><text x='50%' y='56%' text-anchor='middle' fill='white' font-size='54' font-family='system-ui' font-weight='700'>T</text></svg>";

const exts = [".webp",".png",".jpg",".jpeg",".gif"];
const baseDir = { bees: "assets/bees/", masks: "assets/masks/", tools: "assets/tools/" };

function setImgWithFallback(img, kind, id, placeholder){
  let i = 0;
  function tryNext(){
    if(i >= exts.length){ img.src = placeholder; img.onerror = null; return; }
    img.src = baseDir[kind] + id + exts[i++];
  }
  img.onerror = tryNext;
  tryNext();
}

// Dummy data loader (expects data/*.json in your repo)
async function loadJSON(path, fallback){ try{ const r=await fetch(path+'?v='+Date.now()); if(!r.ok) throw 0; return await r.json(); } catch{ return fallback; } }

const state = { bees: [], gear:{masks:[],items:[],tools:[]}, hive:Array.from({length:50},()=>null), mask:null, tool:null };

function mountPalette(){
  const pal = document.getElementById("beePalette"); pal.innerHTML="";
  state.bees.forEach(b=>{
    const div=document.createElement("div"); div.className="bee"; div.draggable=true;
    div.addEventListener("dragstart", e=>e.dataTransfer.setData("text/bee", b.id));
    const img=document.createElement("img"); setImgWithFallback(img,"bees",b.id,PH_BEE); div.appendChild(img);
    const box=document.createElement("div"); box.innerHTML=`<div class="name">${b.name}</div><div class="meta">${b.color}</div>`; div.appendChild(box);
    pal.appendChild(div);
  });
}

function mountHive(){
  const hive = document.getElementById("hive"); hive.innerHTML="";
  for(let i=0;i<50;i++){
    const slot=document.createElement("div"); slot.className="slot"; slot.dataset.idx=i;
    slot.addEventListener("dragover", e=>e.preventDefault());
    slot.addEventListener("drop", e=>{ e.preventDefault(); const id=e.dataTransfer.getData("text/bee"); if(!id) return; state.hive[i]=id; renderHive(); });
    hive.appendChild(slot);
  }
  renderHive();
}

function renderHive(){
  const byId = Object.fromEntries(state.bees.map(b=>[b.id,b]));
  const hive = document.getElementById("hive");
  for(let i=0;i<50;i++){
    const slot=hive.children[i]; const id=state.hive[i];
    slot.classList.remove("filled"); slot.innerHTML="";
    if(id){
      const img=document.createElement("img"); setImgWithFallback(img,"bees",id,PH_BEE); slot.appendChild(img);
      const x=document.createElement("div"); x.className="x"; x.textContent="√ó"; x.onclick=()=>{ state.hive[i]=null; renderHive(); }; slot.appendChild(x);
      slot.classList.add("filled");
    }
  }
}

function mountEquip(){
  const maskSel = document.getElementById("maskSelect"); maskSel.innerHTML = state.gear.masks.map(m=>`<option value="${m.name}">${m.name}</option>`).join("");
  maskSel.onchange = ()=> renderGearIcons();
  const toolSel = document.getElementById("toolSelect"); toolSel.innerHTML = state.gear.tools.map(t=>`<option value="${t.name}">${t.name}</option>`).join("");
  toolSel.onchange = ()=> renderGearIcons();
  const box = document.getElementById("itemsBox"); box.innerHTML = state.gear.items.map(i=>`<label><input type="checkbox" data-id="${i.name}"> ${i.name}</label>`).join(" ");
  renderGearIcons();
}

function renderGearIcons(){
  const wrap=document.getElementById("gearIcons"); wrap.innerHTML="";
  const maskName=document.getElementById("maskSelect").value;
  const toolName=document.getElementById("toolSelect").value;
  const mask=state.gear.masks.find(m=>m.name===maskName);
  const tool=state.gear.tools.find(t=>t.name===toolName);

  function badge(kind, id, label, ph){
    const span=document.createElement("span"); span.className="badge";
    const img=document.createElement("img"); setImgWithFallback(img,kind,id,ph);
    const txt=document.createElement("span"); txt.textContent=label;
    span.appendChild(img); span.appendChild(txt); wrap.appendChild(span);
  }
  if(mask) badge("masks", mask.id, mask.name, PH_MASK);
  if(tool) badge("tools", tool.id, tool.name, PH_TOOL);
}

(async function boot(){
  state.bees = await loadJSON("data/bees.json", []);
  state.gear.masks = await loadJSON("data/masks.json", []);
  state.gear.items = await loadJSON("data/items.json", []);
  state.gear.tools = await loadJSON("data/tools.json", []);
  document.getElementById("maskSelect").value = state.gear.masks[0]?.name || "";
  document.getElementById("toolSelect").value = state.gear.tools[0]?.name || "";
  mountEquip(); mountHive(); mountPalette();
  // Pre-fill first 10 bees as demo
  state.hive = state.bees.slice(0,50).map(b=>b.id).concat(Array(50).fill(null)).slice(0,50);
  renderHive();
})();
</script>
</body>
</html>
